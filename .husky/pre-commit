#!/bin/bash
PROJECT_ROOT="$(git rev-parse --show-toplevel)"
cd "$PROJECT_ROOT"

echo "üéØ Running pre-commit checks..."

# –°–Ω–∞—á–∞–ª–∞ —Ñ–æ—Ä–º–∞—Ç–∏—Ä—É–µ–º
echo "üé® Formatting code..."
npm run format || exit 1

# –ü–æ—Ç–æ–º –ø—Ä–æ–≤–µ—Ä—è–µ–º –ª–∏–Ω—Ç–µ—Ä–æ–º
echo "üîç Running linter..."

# –ü—Ä–æ–≤–µ—Ä—è–µ–º –∫–∞–∫–∏–µ —Ñ–∞–π–ª—ã –∏–∑–º–µ–Ω–µ–Ω—ã
CHANGED_FILES=$(git diff --cached --name-only)

# –õ–∏–Ω—Ç–∏–Ω–≥ –∫–ª–∏–µ–Ω—Ç–∞ –µ—Å–ª–∏ –µ—Å—Ç—å –∏–∑–º–µ–Ω–µ–Ω–∏—è –≤ client/
if echo "$CHANGED_FILES" | grep -q "client/"; then
    echo "üîç Linting client..."
    npm run lint:client || exit 1
fi

# –õ–∏–Ω—Ç–∏–Ω–≥ —Å–µ—Ä–≤–µ—Ä–∞ –µ—Å–ª–∏ –µ—Å—Ç—å –∏–∑–º–µ–Ω–µ–Ω–∏—è –≤ server/
if echo "$CHANGED_FILES" | grep -q "server/"; then
    echo "üîç Linting server..."
    npm run lint:server || exit 1
fi

git add .

echo "‚úÖ Pre-commit checks passed!"